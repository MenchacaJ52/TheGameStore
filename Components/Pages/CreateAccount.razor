@page "/create-account"
@using GameStore.Models
@using GameStore.Data
@using Microsoft.AspNetCore.Components.Forms
@inject GameStore.Data.ApplicationDbContext Db
@inject NavigationManager NavigationManager
@inject Microsoft.Extensions.Logging.ILogger<CreateAccount> Logger

<PageTitle>Create Account</PageTitle>

<div class="row justify-content-center mt-5">
    <div class="col-8">
        <EditForm Model="Account" OnValidSubmit="Save" FormName="CreateAccountForm" autocomplete="off">
            <h3>Create Account</h3>

            <DataAnnotationsValidator />
            <ValidationSummary />

            <div class="mb-3">
                <label for="firstName" class="form-label">First Name</label>
                <InputText id="firstName" class="form-control" @bind-Value="Account.FirstName" />
            </div>

            <div class="mb-3">
                <label for="lastName" class="form-label">Last Name</label>
                <InputText id="lastName" class="form-control" @bind-Value="Account.LastName" />
            </div>

            <div class="mb-3">
                <label for="username" class="form-label">Username</label>
                <InputText id="username" class="form-control" @bind-Value="Account.Username" />
            </div>

            <div class="mb-3">
                <label for="password" class="form-label">Password</label>
                <InputText id="password" type="password" class="form-control" @bind-Value="Account.Password" />
            </div>

            <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <InputText id="email" type="email" class="form-control" @bind-Value="Account.Email" />
            </div>

            <div class="mb-3">
                <label for="address" class="form-label">Address</label>
                <InputTextArea id="address" class="form-control" @bind-Value="Account.Address" />
            </div>

            <div class="mb-3">
                <label for="city" class="form-label">City</label>
                <InputText id="city" class="form-control" @bind-Value="Account.City" />
            </div>

            <div class="row">
                <div class="col-4 mb-3">
                    <label for="state" class="form-label">State</label>
                    <InputText id="state" class="form-control" maxlength="2" @bind-Value="Account.State" />
                </div>
                <div class="col-4 mb-3">
                    <label for="zip" class="form-label">Zip Code</label>
                    <InputText id="zip" class="form-control" @bind-Value="Account.ZipCode" />
                </div>
            </div>

            <button type="submit" class="btn btn-primary">Create Account</button>
        </EditForm>
    </div>
</div>

@code {
    [SupplyParameterFromForm]
    public Account Account { get; set; } = new();

    private async Task Save()
    {
        try
        {
            Db.Accounts.Add(Account);
            await Db.SaveChangesAsync();
            Logger.LogInformation("Account created: {Username}", Account.Username);
            NavigationManager.NavigateTo("/");
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, "Error creating account for {Username}", Account.Username);
        }
    }
}
